# 001.features.02: Close Tab Shortcut with Pane Selection

**Status:** Complete
**Priority:** High

## Objective

Change Cmd+W behavior from closing the entire window to closing the current tab of the selected pane (browser or terminal).

## Context

Currently, Cmd+W closes the entire Janus window because `main.js:238` uses the native `{ role: 'close' }` menu item. The user wants Cmd+W to instead close just the active tab in whichever pane (browser or terminal) is currently selected.

This requires implementing a "selected pane" concept - tracking which pane the user last interacted with, so the close shortcut knows which tab to close.

## Technical Details

### Files to Modify

- `main.js` - Replace `role: 'close'` with custom accelerator that sends IPC
- `renderer.js` - Add pane selection state and handle close-tab IPC
- `preload.js` - Expose new IPC channel

### Implementation Steps

1. **Add selected pane state in renderer.js**
   ```javascript
   // ===== PANE SELECTION STATE =====
   let selectedPane = 'terminal'; // 'browser' or 'terminal'
   ```

2. **Track pane selection on interaction**
   - When clicking browser panel area, browser tabs, or URL input → select browser pane
   - When clicking terminal panel area, terminal tabs, or terminal content → select terminal pane
   - When switching/creating tabs, select that pane

3. **Add visual indicator (optional)**
   - Could add subtle border or background change to show which pane is selected

4. **Update preload.js with new IPC channel**
   ```javascript
   onCloseTab: (callback) => ipcRenderer.on('close-tab', () => callback())
   ```

5. **Update main.js menu**
   - Replace `{ role: 'close' }` with custom menu item:
   ```javascript
   {
     label: 'Close Tab',
     accelerator: 'CmdOrCtrl+W',
     click: () => {
       const win = BrowserWindow.getFocusedWindow();
       if (win) {
         win.webContents.send('close-tab');
       }
     }
   }
   ```

6. **Handle close-tab in renderer.js**
   ```javascript
   window.electronAPI.onCloseTab(() => {
     if (selectedPane === 'browser') {
       closeBrowserTab(activeBrowserId);
     } else {
       closeTab(activeTerminalId);
     }
   });
   ```

7. **Add click listeners for pane selection**
   - Browser panel: `#browser-panel` click sets `selectedPane = 'browser'`
   - Terminal panel: `#terminal-panel` click sets `selectedPane = 'terminal'`
   - Tab switching functions should also update `selectedPane`

## Acceptance Criteria

- [ ] Clicking in browser panel (tabs, content, URL bar) selects browser pane
- [ ] Clicking in terminal panel (tabs, content) selects terminal pane
- [ ] Creating/switching browser tabs selects browser pane
- [ ] Creating/switching terminal tabs selects terminal pane
- [ ] Cmd+W closes current tab of selected pane (not the window)
- [ ] If last tab is closed, a new tab is created (existing behavior preserved)
- [ ] Window can still be closed via Cmd+Shift+W or red traffic light

## Testing

### Test Cases

1. Click in terminal, press Cmd+W → terminal tab closes
2. Click in browser, press Cmd+W → browser tab closes
3. Create new terminal tab, press Cmd+W → new terminal tab closes
4. Create new browser tab, press Cmd+W → new browser tab closes
5. With multiple tabs, verify correct tab closes based on pane selection
6. Verify window close still works via traffic light or Cmd+Q

## References

- Current close behavior: `main.js:238`
- Browser tab management: `renderer.js:26-213`
- Terminal tab management: `renderer.js:327-471`
- Existing keyboard shortcuts: `renderer.js:895-914`
