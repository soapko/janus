# 001.features.01: New Window & Terminal Zoom Features

**Status:** Pending
**Priority:** Medium

## Objective

Add two new features to Janus: (1) File > New menu item to open a new window with a different project folder, and (2) zoom in/out controls for the terminal pane.

## Context

Janus is an Electron app with a two-panel layout: browser on the left, terminal on the right. Currently:
- The app prompts for a project folder on startup via `dialog.showOpenDialog()`
- Only one window can be open at a time (single `mainWindow` variable)
- Terminal uses xterm.js with a fixed `fontSize: 14` in renderer.js

Users need the ability to:
1. Work on multiple projects simultaneously by opening additional Janus windows
2. Adjust terminal font size for readability or to fit more content

## Technical Details

### Feature 1: File > New Window

**Files to Modify:**
- `main.js` - Add Electron Menu with File > New option, refactor window creation

**Implementation Steps:**

1. **Import Menu module**
   Add `Menu` to the Electron imports:
   ```javascript
   const { app, BrowserWindow, ipcMain, dialog, session, Menu } = require('electron');
   ```

2. **Refactor window management**
   Change from single `mainWindow` to supporting multiple windows:
   ```javascript
   const windows = new Set();

   function createWindow(projectPath = null) {
     const win = new BrowserWindow({
       width: 1400,
       height: 900,
       webPreferences: {
         preload: path.join(__dirname, 'preload.js'),
         nodeIntegration: false,
         contextIsolation: true,
         webviewTag: true,
         webSecurity: false
       }
     });

     // Store projectPath on the window object
     win.projectPath = projectPath;
     windows.add(win);

     win.loadFile('index.html');

     win.on('closed', () => {
       windows.delete(win);
       // Kill PTY processes for this window
     });

     return win;
   }
   ```

3. **Create application menu**
   ```javascript
   function createMenu() {
     const template = [
       {
         label: app.name,
         submenu: [
           { role: 'about' },
           { type: 'separator' },
           { role: 'services' },
           { type: 'separator' },
           { role: 'hide' },
           { role: 'hideOthers' },
           { role: 'unhide' },
           { type: 'separator' },
           { role: 'quit' }
         ]
       },
       {
         label: 'File',
         submenu: [
           {
             label: 'New Window',
             accelerator: 'CmdOrCtrl+N',
             click: async () => {
               const result = await dialog.showOpenDialog({
                 properties: ['openDirectory'],
                 title: 'Select Project Folder'
               });
               if (!result.canceled && result.filePaths.length > 0) {
                 createWindow(result.filePaths[0]);
               }
             }
           },
           { type: 'separator' },
           { role: 'close' }
         ]
       },
       { role: 'editMenu' },
       { role: 'viewMenu' },
       { role: 'windowMenu' }
     ];

     const menu = Menu.buildFromTemplate(template);
     Menu.setApplicationMenu(menu);
   }
   ```

4. **Update IPC handlers for multi-window**
   Associate PTY processes with their parent window using `event.sender`:
   ```javascript
   ipcMain.handle('get-project-path', (event) => {
     const win = BrowserWindow.fromWebContents(event.sender);
     return win ? win.projectPath : null;
   });
   ```

### Feature 2: Terminal Zoom In/Out

**Files to Modify:**
- `renderer.js` - Add zoom controls and font size state
- `index.html` - Add zoom buttons to terminal panel header

**Implementation Steps:**

1. **Add zoom state and functions in renderer.js**
   ```javascript
   // Terminal zoom state
   let terminalFontSize = 14;
   const MIN_FONT_SIZE = 8;
   const MAX_FONT_SIZE = 32;

   function setTerminalFontSize(size) {
     terminalFontSize = Math.max(MIN_FONT_SIZE, Math.min(MAX_FONT_SIZE, size));

     // Update all terminal instances
     for (const [id, termInfo] of terminals) {
       termInfo.term.options.fontSize = terminalFontSize;
       termInfo.fitAddon.fit();
       window.electronAPI.resizeTerminal(id, termInfo.term.cols, termInfo.term.rows);
     }
   }

   function zoomInTerminal() {
     setTerminalFontSize(terminalFontSize + 2);
   }

   function zoomOutTerminal() {
     setTerminalFontSize(terminalFontSize - 2);
   }
   ```

2. **Add zoom buttons to terminal panel in index.html**
   Add a header bar to the terminal panel with zoom controls:
   ```html
   <div class="panel" id="terminal-panel">
     <div class="panel-toolbar">
       <span class="panel-title">Terminal</span>
       <div class="zoom-controls">
         <button class="zoom-btn" id="zoom-out-btn" title="Zoom Out">âˆ’</button>
         <button class="zoom-btn" id="zoom-in-btn" title="Zoom In">+</button>
       </div>
     </div>
     <div class="tab-bar" id="tab-bar">
       ...
     </div>
   ```

3. **Add CSS for zoom controls**
   ```css
   .panel-toolbar {
     display: flex;
     align-items: center;
     justify-content: space-between;
     padding: 4px 8px;
     background: #2d2d2d;
     border-bottom: 1px solid #3d3d3d;
   }

   .panel-title {
     font-size: 11px;
     font-weight: 600;
     text-transform: uppercase;
     letter-spacing: 0.5px;
     opacity: 0.7;
   }

   .zoom-controls {
     display: flex;
     gap: 4px;
   }

   .zoom-btn {
     background: #3d3d3d;
     border: none;
     color: #fff;
     width: 24px;
     height: 24px;
     border-radius: 4px;
     cursor: pointer;
     font-size: 16px;
     line-height: 1;
   }

   .zoom-btn:hover {
     background: #4d4d4d;
   }
   ```

4. **Wire up event listeners in renderer.js**
   ```javascript
   document.getElementById('zoom-in-btn').addEventListener('click', zoomInTerminal);
   document.getElementById('zoom-out-btn').addEventListener('click', zoomOutTerminal);
   ```

5. **Update createTab() to use current font size**
   ```javascript
   const term = new Terminal({
     cursorBlink: true,
     fontSize: terminalFontSize,  // Use current font size
     fontFamily: 'Menlo, Monaco, monospace',
     theme: {
       background: '#000000',
       foreground: '#ffffff'
     }
   });
   ```

6. **Optional: Add keyboard shortcuts**
   ```javascript
   document.addEventListener('keydown', (e) => {
     // Focus must be in terminal panel for these to work
     if ((e.metaKey || e.ctrlKey) && e.key === '=') {
       e.preventDefault();
       zoomInTerminal();
     }
     if ((e.metaKey || e.ctrlKey) && e.key === '-') {
       e.preventDefault();
       zoomOutTerminal();
     }
   });
   ```

## Acceptance Criteria

### New Window Feature
- [ ] File menu appears in macOS menu bar with "New Window" option
- [ ] Cmd+N keyboard shortcut triggers folder selection dialog
- [ ] Selecting a folder opens a new Janus window
- [ ] Each window operates independently with its own project path
- [ ] Each window has its own terminal sessions
- [ ] Closing a window does not affect other windows
- [ ] Canceling folder selection does not create a window

### Terminal Zoom Feature
- [ ] Zoom in (+) and zoom out (-) buttons visible in terminal panel
- [ ] Clicking zoom in increases terminal font size
- [ ] Clicking zoom out decreases terminal font size
- [ ] Font size has minimum (8px) and maximum (32px) limits
- [ ] All terminal tabs update when zoom changes
- [ ] New terminal tabs inherit current zoom level
- [ ] Terminal reflows text after zoom

## Testing

### How to Test

1. **New Window:**
   - Run `npm start`
   - Press Cmd+N or use File > New Window
   - Select a different project folder
   - Verify new window opens with correct project path
   - Create terminal tabs in both windows
   - Verify they are independent

2. **Terminal Zoom:**
   - Click zoom in button multiple times
   - Verify font size increases
   - Click zoom out button
   - Verify font size decreases
   - Open new terminal tab, verify it uses current zoom level
   - Test at minimum/maximum limits

### Test Cases

- New Window: Select folder -> Expected: New window opens with that folder
- New Window: Cancel dialog -> Expected: No window created
- New Window: Close one of multiple windows -> Expected: Other windows remain
- Zoom In: Click + at max size -> Expected: Size stays at 32px
- Zoom Out: Click - at min size -> Expected: Size stays at 8px
- Zoom: Change zoom with multiple tabs -> Expected: All tabs update

## References

- Electron Menu documentation: https://www.electronjs.org/docs/latest/api/menu
- Electron BrowserWindow: https://www.electronjs.org/docs/latest/api/browser-window
- xterm.js options: https://xtermjs.org/docs/api/terminal/interfaces/iterminaloptions/
